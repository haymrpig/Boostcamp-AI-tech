# 1. 통계학

- **통계적 모델링**

  적절한 가정 위에서 확률분포를 추정하는 것이 목표!

  유한한 개수의 데이터를 관찰해서 모집단의 분포를 정확하게 아는 것은 불가능하므로 **근사적으로 추정**한다. 

  (근사적 추정으로 충분한 이유는 **예측모형의 목적**은 분포를 정확하게 맞추는 것이 아닌 데이터와 추정 방법의 불확실성을 고려해서 **위험을 최소화**하는 것이기 때문!!)

- **모수적 방법론 & 비모수적 방법론**

  - **모수적 방법론 (parametric)**

    데이터가 **특정 확률분포**를 따른다고 **선험적 (a priori)으로 가정**한 후, 그 분포를 결정하는 모수(parameter)를 추정하는 방법

  - **비모수 방법론 (nonparametric)**

    특정 **확률분포를 가정하지 않고**, 데이터에 따라 모델의 구조 및 모수의 개수가 유연하게 바뀌는 것  (기계학습의 대부분은 비모수 방법론!!)

    !!주의!!

    비모수 방법론이 모수가 없는 것이 아니라, 모수가 무한히 많거나 데이터에 따라 바뀌는 것

    비모수 방법론은 모수를 사용하지 않는다 -> (X)

  - **결론**

    모수와 비모수 방법론의 **차이점은 특정 확률분포를 가정하냐 아니냐**이다. 

- **확률분포 가정하는 방법**

  1. **히스토그램**을 통해 모양을 관찰한다. 
     - `베르누이 분포` : 데이터가 2개의 값 (0 or 1)만 가지는 경우
     - `카테고리 분포` : 데이터가 n개의 이산적인 값을 가지는 경우
     - `베타 분포` : 데이터가 [0,1] 사이에서 값을 가지는 경우
     - `감마 분포 / 로그정규 분포` : 데이터가 0 이상의 값을 가지는 경우
     - `정규분포 / 라프라스분포` : 데이터가 R (실수) 전체에서 값을 가지는 경우
  2. 분포마다 검정하는 방법들이 있으므로, 모수를 추정한 후에는 반드시 **검정**을 해야 한다. 

**EX) 정규분포의 모수는 평균과 분산으로, 이를 추정하는 통계량 (statistic)은 아래 예시와 같다. **
$$
표본평균 : \overline {X}=\frac{1}{N}\sum_{i=1}^NX_i,\;\; 표본분산 : S^2=\frac {1}{N-1}\sum_{i=1}^N(X_i-\overline {X})^2\\
E[\overline X]=\mu, \;E[S^2]=\sigma^2
$$
위 식에서 S^2을 N이 아닌 N-1로 나눠주는 이유는 표본분산을 구할 때, 기댓값을 취했을 때, 원래 모집단의 통계치와 일치하는 것을 유도하기 위함이다.  (**unbiased 추정량**을 구하기 위함)

- **표집분포 (sampling distribution)**

  통계량의 확률분포를 의미한다. 즉, 표본평균과 표본분산의 분포를 표집분포라고 한다. 

  **(!!!!!표분들의 분포 (sample distribution)와는 다르다!!!!!)**

  - **중심극한정리**
    $$
    표집분포는\; N이\; 커질수록(데이터가 많아질수록)\; 정규분포\; N(\mu, \sigma^2/N)을\; 따른다
    $$
    즉, 식에서 볼 수 있듯이 표본평균의 분포는 N이 커질수록 분산이 작아지게 되어 점점 뾰족한 그래프가 된다. 

- **최대가능도 추정법 (MLE, maximum likelihood estimation)**

  표본평균이나 표본분산은 중요한 통계량이지만, 확률분포마다 사용하는 모수가 다르므로 적절한 통계량이 달라지게 된다. 

  이때, 최대가능도 추정법은 이론적으로 가장 가능성이 높은 모수를 추정한다. 
  $$
  \hat{\theta}_{MLE}=argmax_{\theta}L(\theta;x)=argmax_{\theta} P(x|\theta)\\
  $$
  

  - **가능도 함수**
    $$
    argmax_{\theta}L(\theta;x) :가능도\; 함수\\
    주어진\; 데이터\; x에\; 대해서\; 모수\; \theta를 \;변수로\; 가지는\; 함수\\
    즉,\; 데이터가\; 주어진\; 상태에서\; \theta를\; 바꿈으로\; 변하는\; 함수이다.\\
    (likelihood함수는\; 모수\; \theta를 \;따르는\; 분포가\; x를\; 관찰할\; 가능성을\; 뜻하지만\\
    확률로 \;해석하면\; 안된다.)
    $$
    데이터 집합 X가 **독립적**으로 추출되었을 경우 **로그가능도를 최적화**한다. 
    $$
    L(\theta;X)=\Pi_{i=1}^nP(x_i|\theta)\;\Rightarrow\;logL(\theta;X)=\sum_{i=1}^nlogP(x_i|\theta)
    $$
    log함수의 특성상 곱을 합으로 바꿔준다. 이러한 특성을 이용해서 곱으로 표현되어 있던 likelihood함수를 summation으로 바꿔준다. 

  - **로그가능도를 사용하는 이유**

    1. 데이터의 수가 수억 단위이면 컴퓨터의 정확도로는 가능도를 계산하는 것은 불가능하다.

       (연산 오차 때문에 곱셈에서 오차가 발생)

    2. 경사하강법으로 가능도를 **최적화**할 때 미분 연산을 사용하는데, 로그 가능도를 사용하면 연산량을 O(n^2)에서 O(n)으로 줄일 수 있다. 

       (`최적화` : loss function의 결과값을 최소화하는 모델의 인자를 찾는 것을 의미)

    3. 로그가능도의 경우 보통 maximum을 찾는데 사용하기 때문에, 대게의 손실함수에서 사용하는 경사하강법을 이용하려면 **음의 로그가능도** (negetive log likelihood)를 이용하여 최적화한다. 

**EX) 최대가능도 추정법 예제 : 정규분포**

정규분포를 따르는 확률변수 X로부터 독립적인 표본 {x1, ..., xn}을 얻었을 때 최대가능도 추정법을 이용하여 모수를 추정하라
$$
\begin{aligned}
logL(\theta;X)=\sum_{i=1}^nlogP(x_i|\theta)&=\sum_{i=1}^nlog\frac{1}{\sqrt{2\pi\sigma^2}}e^{-|x_i-\mu|^2/2\sigma^2}\\
&=-\frac{n}{2}log2\pi\sigma^2-\sum_{i=1}^{n}\frac{|x_i-\mu|^2}{2\sigma^2}
\end{aligned}
$$
여기서 argmax_theta 즉, theta에 대해서 가장 큰 값을 찾아야 함으로 미분을 취해서 0인 값을 찾으면 된다. (2차함수에서 극대, 극소 찾듯이) 
$$
각각\; \mu와 \;\sigma에 \;대해\; 미분을\; 하게\; 되면\\
0 = \frac {\partial logL}{\partial\mu}=\sum_{i=1}^{n}\frac{x_i-\mu}{\sigma^2}\Rightarrow \hat{\mu}_{MLE}=\frac{1}{n}\sum_{i=1}^{n}x_i\\
0=\frac {\partial logL}{\partial\sigma}=-\frac{n}{\sigma}+\frac{1}{\sigma^3}\sum_{i=1}^{n}{|x_i-\mu|}^2\Rightarrow \hat{\sigma}^2_{MLE}=\frac{1}{n}\sum_{i=1}^{n}(x_i-\mu)^2
$$
(MLE는 unbiased 추정량을 보장하진 않는다!)

**EX1) 최대가능도 추정법 예제 : 카테고리 분포 (Multinoulli)**

카테고리 분포 Multinoulli(x;p1,...,pd)를 따르는 확률변수 X로부터 독립적인 표본 {x1,...,xn}을 얻었을 때 최대가능도 추정법을 이용하여 모수를 추정하라

카테고리 분포의 모수 p1부터 pd는 1차원부터 d차원까지 각각의 차원에서 값이 1 또는 0이 될 확률로, 이 확률을 모두 더하면 1이다. 

(제약식이 있는 경우 라그랑주 승수법을 사용)
$$
즉,\; 카테고리\; 분포의 \;모수는\; \sum_{k=1}^{d}p_k=1을 \;만족해야한다\;.
$$

$$
\begin{aligned}
\hat{\theta}_{MLE}=argmax_{p_1,...p_d}logP(x_i|\theta)&=argmax_{p_1,...p_d}log(\Pi_{i=1}^{n}\Pi_{i=1}^{n}p_k^{x_{i,k}})\\ &(p_k^{x_{i,k}}는\; x_{i,k}가\; 지수로\; 들어간다.)\\
&=\sum_{k=1}^d(\sum_{i=1}^{n}x_{i,k})logp_k
\\&(x_{i,k}는\; 0\;또는\;1이므로, \sum_{i=1}^{n}x_{i,k}=n_k즉, k의\; 개수라고\; 표현가능)\\
&=\sum_{k=1}^{d}n_klogp_k\quad (\sum_{k=1}^{d}p_k=1일\; 때)\\

\end{aligned}
$$

$$
\Rightarrow L(p_1,...,p_k, \lambda)=\sum_{k=1}^{d}n_klogp_k+\lambda(1-\sum_kp_k), \quad(제약식을\; 넘기고\; \lambda를\; 곱함)\\
(L은 \;라그랑주 \;승수법)
\\
\Rightarrow 0=\frac{\partial{L}}{\partial p_k}=\frac{n_k}{p_k}-\lambda,\;0= \frac{\partial{L}}{\partial \lambda}=1-\sum_{k=1}^dp_k)\\
\Rightarrow p_k=\frac {n_k}{\sum_{k=1}^dn_k}=\frac{n_k}{n}\\
(\sum_{k=1}^dp_k=1이고,\; p_k=n_k\lambda를\; 대입하면\; \sum_{k=1}^dn_k=\lambda)
$$

- **딥러닝에서 최대가능도 추정법**
  $$
  딥러닝\; 모델의\; 가중치를\; \theta=(W^{(1)}, ..., W^{(L)})라\; 표현했을 \;때,\\
  분류\; 문제\; 소프트맥스\; 벡터는\; 카테고리분포의\; 모수 (p_1, ..., p_k)를\; 모델링한다.\\
  one-hot 벡터로\; 표현한\; 정답레이블\; y=(y_1,...,y_k)을\; 관찰데이터로\; 이용해\\
  확률분포인 \;소프트맥스\; 벡터의\; 로그가능도를\; 최적화할\; 수\; 있다.\\
  \hat{\theta}_{MLE}=argmax_{\theta}\frac{1}{n}\sum_{i=1}^n\sum_{k=1}^{K}y_{i,k}log(MLP_\theta(x_i)_k)
  $$
  

- **확률분포의 거리 구하기**

  loss function들은 모델이 학습하는 확률분포와 데이터에서 관찰되는 확률분포의 거리를 통해 유도된다. 

  데이터공간에 두개의 확률분포 P(x), Q(x)가 있을 경우 두 확률분포 사이의 거리(distance)를 계산할 때 다음과 같은 함수들을 사용한다. 

  - 총변동 거리 (TV, Total Variation Distance)

  - **쿨백-라이블러 발산 (KL, Kullback-Leibler Divergence)**
    $$
    KL(P||Q)=\sum_{x\in X}P(x)log(\frac{P(x)}{Q(x)}),\;\;KL(P||Q)=\int_XP(x)log(\frac{P(x)}{Q(x)})dx
    $$
    왼쪽 식이 이산, 오른쪽 식이 연속인 경우이며, 위 식은 아래와 같이 분해될 수 있다. 
    $$
    KL(P||Q)=-E_{x\sim P(x)}[logQ(x)]+E_{x\sim P(x)}[logP(x)]\\
    E_{x\sim P(x)}[logQ(x)]:크로스\;엔트로피\\
    E_{x\sim P(x)}[logP(x)]:엔트로피
    $$
    분류문제에서 정답레이블을 P, 모델 예측을 Q라 두면 **최대가능도 추정법은 쿨백-라이블러 발산을 최소화하는 것**과 같다. 

    쉽게 말해서, 쿨백-라이블러 발산을 통해 확률분포의 거리를 구하는 것과 최대가능도 추정법에서의 로그가능도를 최대화하는 것은 밀접한 관련이 있다는 뜻이다. 

    두개의 확률분포의 거리를 최소화시킨다는 것은 주어진 데이터를 통해서 목적으로 하는 확률분포에 최적화된 모수를 구하는 것과 동일한 개념이다.

  - 바슈타인 거리 (Wasserstein Distance)